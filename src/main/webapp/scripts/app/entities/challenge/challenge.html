<div>
    <div class="row">
        <div class="col-md-10">
            <h3 style="margin-top:2px;">Réservation de créneaux pour la soirée Défi Natation du 9 Juillet 2016</h3>
        </div>
        <div class="col-md-2" ng-if="vm.connected">
            <span class="badge badge-reserved" data-tooltip="Créneaux réservés">{{vm.user.nbReserved}}</span>
            <span class="badge badge-payed" data-tooltip="Créneaux payés">{{vm.user.nbPayed}}</span>
            <button type="button" class="btn btn-info" ui-sref="print" ng-disabled="!vm.user.nbReserved"
                    data-tooltip="Impression de votre coupon réservation">
                Imprimer&nbsp;<span class="glyphicon glyphicon-print"></span>
            </button>
        </div>
    </div>
    <h5>Ci-dessous se trouve le planning de la soirée de natation pour le
        <a href="http://www.defi-anthony.org/" target="_blank">Défi Anthony</a>.</h5>
    <h5>Pour réserver un nouveau créneau, vous pouvez cliquer sur un créneau disponible (bleu).</h5>

    <div class="panel-group" style="margin-bottom: 10px;">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#collapse1">Pour plus de renseignement, cliquez ici</a>
                </h4>
            </div>
            <div id="collapse1" class="panel-collapse collapse">
                <div class="panel-body">

                    <p>Le
                        <a href="http://natationchauffailles.e-monsite.com" target="_blank">club de natation de Chauffailles</a>
                        organise un défi Natation le <b>9 juillet 2016</b> à partir de <b>18h</b> à
                        la piscine intercommunale du <b>Sud Brionnais</b> de Chauffailles.</p>

                    <p>100% de l’argent collecté lors de cette soirée sera reversé à l’association
                        <a href="http://www.defi-anthony.org/" target="_blank">Défi Anthony</a> qui collecte des fonds
                        pour la lutte contre la leucémie.</p>

                    <div class="bs-callout bs-callout-info">
                        Notre défi Natation consistera à additionner toutes les longueurs qui seront nagées lors de la
                        soirée du 9 juillet 2016 afin d’obtenir la plus grande distance possible : 10, 20, 30, ... 50km ???
                        <br>
                        Ainsi, toutes les 5 minutes, des nageurs, seuls ou en équipe (maximum 4 personnes) prendront le
                        départ pour réaliser un <b>maximum de longueurs</b> pendant <b>5 minutes</b>.
                    </div>

                    <p>Toute personne qui sait nager (donc à partir de 6/7 ans) peut participer afin qu’un maximum de
                        longueurs soient nagées ce soir-là. Peu importe la nage, le style, l’essentiel étant de
                        participer afin d’apporter une aide précieuse à la recherche contre la leucémie.</p>

                    <p>Mais, si vous ne voulez ou ne pouvez pas nager, vous pouvez vous aussi <b>contribuer à la réussite</b>
                        de ce défi en constituant une équipe qui nagera pour vous ; vous serez alors le <b>parrain</b> de cette
                        équipe et vous paierez l’inscription à sa place.</p>

                    Pour participer, il suffit donc :
                    <ul>
                        <li>de nager 5 minutes seul</li>
                        <li>de nager en équipe (4 nageurs max) pendant 5 minutes en désignant un capitaine.</li>
                        <li>de parrainer une équipe (de 1 à 4 nageurs) et de payer l’inscription à sa place.</li>
                    </ul>

                    <p>L’inscription, pour un créneau de 5 minutes, coûte 9 €, entièrement reversés à la <b>recherche contre la
                        leucémie</b> par l’intermédiaire de l’Association <i>Défi Anthony</i>.</p>

                    <div class="bs-callout bs-callout-success">
                        Pour une bonne organisation, nous vous demandons si possible, de vous inscrire ou d’inscrire une
                            équipe à l’avance ce qui vous permettra de choisir le créneau-horaire.
                        <br>Vous pouvez le faire directement sur ce site en <b>réservant un créneau</b>. Les créneaux disponibles
                            sont colorés bleu. Il est possible de réserver un créneau en cliquant dessus (après création
                            d'un compte).
                    </div>

                    <p>L’inscription ne sera définitive que lorsque le parrain ou le capitaine de l’équipe aura fait
                        parvenir le règlement correspondant à l’inscription soit au salon Evolu’tifs, soit chez madame
                        Anne Luccioni. Règlement uniquement par chèque à l’ordre de l’Association <i>Défi Anthony</i>.</p>

                    <div class="bs-callout bs-callout-info">
                        Vous avez aussi la possibilité de réserver des plateaux-repas qui seront servis au cours de la
                            <b>soirée du 9 juillet</b> constitués d’une entrée (macédoine de légumes), d’une tranche de rôti avec
                            des chips, d’une portion de fromage et d’une part de tarte aux pommes (possibilité de remplacer
                            la tranche de rôti par un morceau de poulet).
                    </div>
                    <p>
                        La réservation finale de ces créneaux ne sera effective qu'après réception du règlement.
                        Pour cela, vous pouvez imprimer votre bulletin d'inscription en cliquant sur le bouton
                        en haut à droite
                        <button class="btn btn-xs btn-info">
                            Imprimer&nbsp;<span class="glyphicon glyphicon-print"></span>
                        </button>. Les organisateurs de cette soirée annuleront cette réservation
                        si aucun règlement n'est reçu sous 8 jours.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="vm.currentTimeslot" class="well challenge-well well-sm row">

        <div ng-if="vm.currentTimeslot.reserved">

            <form class="form-horizontal form-challenge form-challenge-static" ng-if="vm.currentTimeslot.reserved">
                <h4>Créneau {{vm.currentTimeslot.payed ? "payé" : "réservé"}}
                    <span has-authority="ROLE_ADMIN" ng-if="!vm.currentTimeslot.payed"> le
                        {{vm.currentTimeslot.reservedDate | date:"dd/MM/yyyy"}}
                    </span>
                    par {{vm.currentTimeslot.user.displayName}}
                    <button type="button" ng-click="vm.eraseTimeslot()" has-authority="ROLE_ADMIN"
                            class="btn btn-danger btn-sm">
                        <span class="glyphicon glyphicon-remove-circle"></span>
                        Supprimer
                    </button>
                </h4>
                <div class="row">
                    <div class="col-sm-7">
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Créneau</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.startTime}} - {{vm.currentTimeslot.endTime}}</p></div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Ligne</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.line}}</p></div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Nom d'équipe</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.teamName}}</p></div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Capitaine</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.user.displayName}}</p></div>
                        </div>
                    </div>
                    <div class="col-sm-5">
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Nageur 1</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.swimmer1}}</p></div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Nageur 2</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.swimmer2}}</p></div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Nageur 3</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.swimmer3}}</p></div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Nageur 4</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.swimmer4}}</p></div>
                        </div>
                    </div>
                </div>

            </form>

        </div>

        <div ng-if="!vm.currentTimeslot.reserved">
            <form name="editForm" role="form" class="form-horizontal form-challenge" novalidate show-validation>
                <h4>Réservation de ce créneau :</h4>
                <div ng-if="!vm.connected">
                    <form class="form-horizontal form-challenge form-challenge-static">
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Créneau</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.startTime}} - {{vm.currentTimeslot.endTime}}</p></div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">Ligne</label>
                            <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.line}}</p></div>
                        </div>
                    </form>
                    Pour continuer la réservation de ce créneau, merci de bien vouloir vous
                    <a class="hand" ng-click="vm.goToLogin()">connecter</a>.
                </div>
                <div ng-if="vm.connected">
                    <jh-alert-error></jh-alert-error>
                    <div class="form-group" ng-if="vm.isAuthenticated()">
                        <div class="row">
                            <div class="col-sm-7">
                                <form class="form-horizontal form-challenge form-challenge-static">
                                    <div class="form-group">
                                        <label class="col-xs-3 control-label">Créneau</label>
                                        <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.startTime}} - {{vm.currentTimeslot.endTime}}</p></div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-3 control-label">Ligne</label>
                                        <div class="col-xs-9"><p class="form-control-static">{{vm.currentTimeslot.line}}</p></div>
                                    </div>
                                    <div class="form-group" has-authority="ROLE_ADMIN">
                                        <label class="col-xs-3 control-label">Capitaine</label>
                                        <div class="col-sm-4">
                                            <select class="form-control" ng-model="vm.userCreationType"
                                                    ng-options="userType as userType.label for userType in vm.userCreationTypes">
                                            </select>
                                        </div>
                                        <div class="col-sm-5">
                                            <p class="form-control-static" ng-if="vm.userCreationType === vm.userCreationTypes.CURRENT">
                                                {{vm.user.displayName}}
                                            </p>
                                            <div ng-if="vm.userCreationType === vm.userCreationTypes.NEW">
                                                <input type="text" class="form-control input-sm" placeholder="Nom de famille"
                                                       ng-model="vm.currentTimeslot.user.lastName"/>
                                                <input type="text" class="form-control input-sm" placeholder="Prénom"
                                                       ng-model="vm.currentTimeslot.user.firstName"/>
                                                <input type="text" class="form-control input-sm" placeholder="E-mail"
                                                       ng-model="vm.currentTimeslot.user.email"/>
                                            </div>
                                            <select class="form-control" ng-model="vm.currentTimeslot.user"
                                                    ng-options="user as user.displayName for user in vm.users"
                                                    ng-if="vm.userCreationType === vm.userCreationTypes.EXISTING">
                                            </select>
                                        </div>
                                    </div>
                                </form>

                                <div class="text-center" style="margin-top:20px">
                                    <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="vm.currentTimeslot = undefined">
                                        <span class="glyphicon glyphicon-ban-circle"></span>&nbsp;<span>Annuler</span>
                                    </button>
                                    <button type="button" ng-disabled="editForm.$invalid || vm.isSaving" class="btn btn-primary" ng-click="vm.saveTimeslot()">
                                        <span class="glyphicon glyphicon-save"></span>&nbsp;<span>Sauvegarder</span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-sm-5">
                                <form class="form-horizontal form-challenge">
                                    <div class="form-group">
                                        <label class="col-xs-3 control-label" for="field_teamName">Nom d'équipe</label>
                                        <div class="col-xs-9">
                                            <input type="text" class="form-control input-sm" name="teamName" id="field_teamName"
                                                   ng-model="vm.currentTimeslot.teamName"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-3 control-label" for="field_swimmer1">Nageur 1</label>
                                        <div class="col-xs-9">
                                            <input type="text" class="form-control input-sm" name="swimmer1" id="field_swimmer1"
                                                   ng-model="vm.currentTimeslot.swimmer1"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-3 control-label" for="field_swimmer2">Nageur 2</label>
                                        <div class="col-xs-9">
                                            <input type="text" class="form-control input-sm" name="swimmer2" id="field_swimmer2"
                                                   ng-model="vm.currentTimeslot.swimmer2"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-3 control-label" for="field_swimmer3">Nageur 3</label>
                                        <div class="col-xs-9">
                                            <input type="text" class="form-control input-sm" name="swimmer3" id="field_swimmer3"
                                                   ng-model="vm.currentTimeslot.swimmer3"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-3 control-label" for="field_swimmer4">Nageur 4</label>
                                        <div class="col-xs-9">
                                            <input type="text" class="form-control input-sm" name="swimmer4" id="field_swimmer4"
                                                   ng-model="vm.currentTimeslot.swimmer4"/>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>

                </div>
            </form>
        </div>

    </div>
    <jh-alert></jh-alert>
    <div ng-repeat="tbt in vm.timeslotsByTime">
        <table class="jh-table table challenge-table">
            <thead>
            <tr>
                <th>Ligne</th>
                <th ng-repeat="(time, timeslots) in tbt.byTime">
                    {{time}}
                </th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="(line, timeslots) in tbt.byLine">
                <td>{{line}}</td>
                <td ng-repeat="timeslot in timeslots" class="text-right challenge-td {{vm.getClass(timeslot)}}"
                    data-tooltip="{{vm.getTooltip(timeslot)}}" data-tooltip-placement="top"
                    tooltip-append-to-body="true" ng-click="vm.currentTimeslot = timeslot">
                    <span class="glyphicon glyphicon-user" ng-if="vm.user && timeslot.user.id===vm.user.id"></span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
